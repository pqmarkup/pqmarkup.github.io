var BBCodes_title='';var BBCodes_know={'B':{'tag':'<b>B</b>','img':'folder_editor_buttons/b.png','func':'B','title':'Жирный'},'I':{'tag':'<i>I</i>','img':'folder_editor_buttons/i.png','func':'I','title':'Курсив'},'U':{'tag':'<u>U</u>','img':'folder_editor_buttons/u.png','func':'U','title':'Подчёркивание'},'S':{'tag':'<s>S</s>','img':'folder_editor_buttons/s.png','func':'S','title':'Зачёркивание'},'SUB':{'tag':'X<sub>2</sub>','img':'folder_editor_buttons/sub.png','func':'SUB','title':'Подстрочный текст'},'SUP':{'tag':'X<sup>2</sup>','img':'folder_editor_buttons/sup.png','func':'SUP','title':'Надстрочный текст'},'LEFT':{'tag':'<div style="width:30px;text-align:left;">&lt;=</div>','img':'folder_editor_buttons/left.png','func':'LEFT','title':'Влево'},'CENTER':{'tag':'<div style="width:30px;text-align:center;">&lt;=&gt;</div>','img':'folder_editor_buttons/center.png','func':'CENTER','title':'По центру'},'RIGHT':{'tag':'<div style="width:30px;text-align:right;">=&gt;</div>','img':'folder_editor_buttons/right.png','func':'RIGHT','title':'Вправо'},'URL':{'tag':'<font color="blue"><b><u>http://</u></b></font>','img':'folder_editor_buttons/url.png','func':'URL','title':'Вставить гиперссылку'},'MAIL':{'tag':'<font color="blue"><b><u>[@]</u></b></font>','img':'folder_editor_buttons/mail.png','func':'mail','title':'Вставить E-Mail'},'IMAGE':{'tag':'Картинка','img':'folder_editor_buttons/image.png','func':'image','title':'Вставить картинку'},'QUOTE':{'tag':'<b>&copy;</b>','img':'folder_editor_buttons/quote.png','func':'QUOTE','title':'Вставить цитату'},'OFFTOP':{'tag':'Оффтоп','img':'folder_editor_buttons/offtop.png','func':'OFFTOP','title':'Оффтоп'},'CODE':{'tag':'Код','img':'folder_editor_buttons/code.png','func':'CODE','title':'Вставить код'},'SPOILER':{'tag':'Спойлер','img':'folder_editor_buttons/spoiler.png','func':'SPOILER','title':'Сделать текст сворачиваемым'},'SPOIL':{'tag':'Спойлер с заголовком','img':'folder_editor_buttons/spoil.png','func':'spoil','title':'Сделать текст сворачиваемым и добавить заголовок'},'HIDE':{'tag':'Скрытый текст','img':'folder_editor_buttons/hide.png','func':'HIDE','title':'Скрытый текст'},'LIST':{'tag':'Список','img':'folder_editor_buttons/list.png','func':'list','title':'Вставить список'},'LIST=1':{'tag':'Нумерованный список','img':'folder_editor_buttons/numlist.png','func':'list1','title':'Вставить нумерованный список'},'CUR':{'tag':'<font color="green"><b>C</b></font>','img':'folder_editor_buttons/cur.png','func':'CUR','title':'Сообщение куратора'},'MOD':{'tag':'<font color="blue"><b>M</b></font>','img':'folder_editor_buttons/mod.png','func':'MOD','title':'Сообщение модератора'},'EX':{'tag':'<font color="red"><b>!</b></font>','img':'folder_editor_buttons/ex.png','func':'EX','title':'Предупреждение'},'CLEAR':{'tag':'[x]','img':'folder_editor_buttons/clear.png','func':'clear_bb','title':'Удалить все BB коды'},'BBHELP':{'tag':'[?]','img':'folder_editor_buttons/bb_help.png','func':'bbhelp','title':'Помощь по ББ кодам'},'PLUS':{'tag':'+','img':'folder_editor_buttons/area_plus.png','func':'PLUS','title':'Увеличить форму ответа'},'MINUS':{'tag':'-','img':'folder_editor_buttons/area_minus.png','func':'MINUS','title':'Уменьшить форму ответа'}};function BBCodes(BBEditor,_obj){ this.initialize=false;this.BBEditor=BBEditor;this.editor_id=BBEditor.editor_id;this._objname=_obj;this._obj=BBEditor[_obj];this.init=function(){if(this.initialize){return;}if(!this._obj){return;}var codes=this._obj.innerHTML.replace(/(\r|\n|\t)/g,' ').replace(new RegExp("<(.+?)>","ig"),'').split(' ');this._obj.innerHTML='';this._obj.style.width='100%';this.BBEditor.create_panel_title(this._obj,BBCodes_title);this._obj.className='ed-panel';for(var i=0;i<codes.length;i++){if(!BBCodes_know[codes[i]]){continue;}var _i=BBCodes_know[codes[i]];var _o=null;if(_i['img']){_o=document.createElement('img');_o.src=ipb_var_image_url+'/'+_i['img'];_o.border='0';_o.is_down=0;_o.align='top';_o.className='ed-bbcode-normal';_o.onmousemove=function(){if(!this.is_down){this.className='ed-bbcode-hover';}};_o.onmousedown=function(){this.is_down=1;this.className='ed-bbcode-down';};_o.onmouseup=function(){this.is_down=0;this.className='ed-bbcode-hover';};_o.onmouseout=function(){this.is_down=0;this.className='ed-bbcode-normal';};if(_i['title']){_o.alt=_i['title'];}}else{ _o=document.createElement('button');_o.className='ed-bbcode';_o.innerHTML=_i['tag'];}if(_i['style']){var style=true;try{_o.style=_i['style'];style=false;}catch(e){} if(style){var style=this.BBEditor.parse_style(_i['style']);for(var key in style){try{_o.style[key]=style[key];}catch(e){}}}}if(_i['title']){_o.title=_i['title'];}_o.cmd=_i['func'];_o.editor_id=this.editor_id;_o._objname=this._objname;_o.onclick=function(e){var retval=true;if(!e){e=window.event;}if(e.type=='click'){var cl=BBEditors[this.editor_id][this._objname].cl;retval=cl.go_action(e,this);}return retval;};this._obj.appendChild(_o);}this.initialize=true;};this.go_action=function(e,_obj){var retval=true;if(e.type!='click'){return retval;}if(this[_obj.cmd]){retval=this[_obj.cmd]();}else{ this.BBEditor.wrap_text('['+_obj.cmd+']','[/'+_obj.cmd+']');retval=false;}return retval;};this.clear_bb=function(){var _t=this.BBEditor._textarea;_t.value=_t.value.replace(/\[(.*?)\]/gi,'');return false;};this.spoil=function(){var _text=this.BBEditor.get_select_text();var _title=prompt('Введите заголовок спойлера','');if(!_title||_title==null||_title==''){return false;}if(!_text||_text==null||_text==''){_text=prompt('Введите содержание спойлера','');if(!_text||_text==null||_text==''){return false;}this.BBEditor.insert_text('[SPOILER='+_title+']'+_text+'[/SPOILER]');}else{this.BBEditor.wrap_text_option('SPOILER',_title);}return false;};this.URL=function(){var _text=this.BBEditor.get_select_text();var _url=prompt(ipb_global_lang['editor_enter_url'],'http://');if(!_url||_url==null||_url=='http://'){return false;}if(!_text||_text==null||_text==''){_text=prompt(ipb_global_lang['editor_enter_title'],ipb_global_lang['visit_my_website']);if(!_text||_text==null||_text==''){return false;}if((_url+"").substr(0,6).toLowerCase()=='http//'){_url="http://"+(_url+"").substr(6);}if(["http:","https","magne","ftp:/"].indexOf((_url+"").substr(0,5).toLowerCase())<0){_url="http://"+_url;}this.BBEditor.insert_text('[URL='+_url+']'+_text+'[/URL]');}else{ this.BBEditor.wrap_text_option('URL',_url);}return false;};this.mail=function(){var _text=this.BBEditor.get_select_text();var _url=prompt(ipb_global_lang['editor_enter_email'],'');if(!_url||_url==null||_url==''){return false;}if(!_text||_text==null||_text==''){_text=prompt(ipb_global_lang['editor_enter_title'],'');if(!_text||_text==null||_text==''){return false;}this.BBEditor.insert_text('[EMAIL='+_url+']'+_text+'[/EMAIL]');}else{ this.BBEditor.wrap_text_option('EMAIL',_url);}return false;};this.image=function(){var _url=this.BBEditor.get_select_text();if(!_url||_url==null||_url=='http://'||_url==''){_url=prompt(ipb_global_lang['editor_enter_image'],'http://');if(!_url||_url==null||_url=='http://'){return false;}this.BBEditor.insert_text('[IMG]'+_url+'[/IMG]');}else{ this.BBEditor.wrap_text('[IMG]','[/IMG]');}return false;};this.list=function(){return this.createlist('LIST');};this.list1=function(){return this.createlist('LIST=1');};this.createlist=function(_1){var _t=this.BBEditor.get_select_text();var vals=[];if(_t!=''){var lines=_t.replace(/(\r)/g,'').split("\n");_t='';for(var i=0;i<lines.length;i++){lines[i]=lines[i].replace(/^\s*(.*?)\s*$/g,'$1');if(lines[i]!=''){vals[vals.length]="[*]"+lines[i];}} }else{ vals=this.get_list_vals();}if(vals.length>0){_t="["+_1+"]"+vals.join("\n")+"[/LIST]\n";}this.BBEditor.insert_text(_t);return false;};this.get_list_vals=function(){var _a=new Array;var _i=null;do{_i=prompt('Введите содержание '+(_a.length+1)+' пункта списка.','');if(_i&&_i!=null&&_i.replace(/^\s*(.*?)\s*$/g,'$1')!=''){_a[_a.length]='[*]'+_i;}}while(_i&&_i!=null&&_i!='');return _a;};this.PLUS=function(){var rows=parseInt(this.BBEditor._textarea.rows);if(isNaN(rows)){rows=BBEditors_minimum_rows;}else{ rows+=5;}ipsclass.my_setcookie('editor_'+this.editor_id+'_rows',rows,1);this.BBEditor._textarea.rows=rows;return false;};this.MINUS=function(){var rows=parseInt(this.BBEditor._textarea.rows);if(isNaN(rows)){rows=BBEditors_minimum_rows;}else{ rows-=5;if(rows<BBEditors_minimum_rows){rows=BBEditors_minimum_rows;}} ipsclass.my_setcookie('editor_'+this.editor_id+'_rows',rows,1);this.BBEditor._textarea.rows=rows;return false;};this.bbhelp=function(){window.open(ipb_var_base_url+"act=legends&CODE=bbcode","Legends","width=700,height=500,resizable=yes,scrollbars=yes");return false;};this.init();}
