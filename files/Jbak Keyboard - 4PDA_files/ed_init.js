var BBEditors_loading_message="Инициализация редактора";var BBEditors_minimum_rows=17;/*Минимальное количество строк в редакторе*/var BBEditors_textarea_cahnge_rows=3;/*количество строк изменения размера формы редактирования*/var BBEditors_panel_title_width=110;BBEditors=new Array();function BBEditor(editor_id,use_bbcode,file_path){ this.editor_id=editor_id;this.use_bbcode=use_bbcode;this.file_path=file_path;if(file_path!= ''&&file_path.substr(file_path.length-1,1)!='/'){this.file_path+='/';}this.initialize=false;this._wind_resize=false;this._wrap=document.getElementById(this.editor_id+'_wrap');this._loader=document.getElementById(this.editor_id+'_loader');this.div_advanced_panel=document.getElementById(this.editor_id+'_ap');this.div_toggle_advanced_panel=document.getElementById(this.editor_id+'_t_ap');this.div_bbcode=document.getElementById(this.editor_id+'_bbc');this.div_panel_size=document.getElementById(this.editor_id+'_ps');this.div_panel_color=document.getElementById(this.editor_id+'_pc');this.div_moder_tags=document.getElementById(this.editor_id+'_mt');this._textarea=document.getElementById(this.editor_id+'_textarea');this.div_textarea_functions=document.getElementById(this.editor_id+'_tf');this.div_smile_panel=document.getElementById(this.editor_id+'_sp');this.div_toggle_smile_panel=document.getElementById(this.editor_id+'_t_sp');this.div_adv_panel=document.getElementById(this.editor_id+'_atp');this.div_toggle_adv_panel=document.getElementById(this.editor_id+'_t_atp');this.init=function(){if(this.initialize){return;}this.init_loader();var el_arr=new Array(this.div_smile_panel,this.div_toggle_smile_panel,this.div_bbcode,this.div_panel_size,this.div_panel_color,this.div_moder_tags,this.div_advanced_panel,this.div_toggle_advanced_panel);for(var i=0;i<el_arr.length;i++){if(el_arr[i]){el_arr[i].style.display='none';}} this._init_textarea();this._set_loader_text(1);this.init2();};this.init2=function(){if(this.div_toggle_advanced_panel&&this.div_advanced_panel){if(typeof(BBToggles)=='undefined'){this.import_js(this.file_path+'ed_toggle.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init2();",100);return;}this._set_loader_text(2);this.div_toggle_advanced_panel.cl=new BBToggles(this,'div_toggle_advanced_panel','div_advanced_panel');this.div_toggle_advanced_panel.style.display='';}this.init3();};this.init3=function(){if(this.div_smile_panel){if(typeof(BBSmiles)=='undefined'){this.import_js(this.file_path+'ed_smiles.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init3();",100);return;}this._set_loader_text(3);this.div_smile_panel.cl=new BBSmiles(this,'div_smile_panel');this.div_smile_panel.style.display='';}this.init4();};this.init4=function(){if(this.div_smile_panel&&this.div_toggle_smile_panel){if(typeof(BBToggles)=='undefined'){this.import_js(this.file_path+'ed_toggle.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init4();",100);return;}this._set_loader_text(4);this.div_toggle_smile_panel.cl=new BBToggles(this,'div_toggle_smile_panel','div_smile_panel');this.div_toggle_smile_panel.style.display='';}this.init5();};this.init5=function(){if(this.div_adv_panel){if(typeof(BBAdvCodes)=='undefined'){this.import_js(this.file_path+'ed_advbb.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init5();",100);return;}this._set_loader_text(5);this.div_adv_panel.cl=new BBAdvCodes(this,'div_adv_panel');this.div_adv_panel.style.display='';}this.init6();};this.init6=function(){if(this.div_adv_panel&&this.div_toggle_adv_panel){if(typeof(BBToggles)=='undefined'){this.import_js(this.file_path+'ed_toggle.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init6();",100);return;}this._set_loader_text(6);this.div_toggle_adv_panel.cl=new BBToggles(this,'div_toggle_adv_panel','div_adv_panel');this.div_toggle_adv_panel.style.display='';}this.init7();};this.init7=function(){if(typeof(BBCodes)=='undefined'){this.import_js(this.file_path+'ed_bbcodes.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init7();",100);return;}this._set_loader_text(7);if(this.div_textarea_functions){this.div_textarea_functions.cl=new BBCodes(this,'div_textarea_functions');}if(this.use_bbcode){if(this.div_bbcode){this.div_bbcode.cl=new BBCodes(this,'div_bbcode');this.div_bbcode.style.display='';}} this.init8();};this.init8=function(){if(this.use_bbcode){if(this.div_panel_size){if(typeof(BBSizes)=='undefined'){this.import_js(this.file_path+'ed_sizes.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init8();",100);return;}this.div_panel_size.cl=new BBSizes(this,'div_panel_size');this.div_panel_size.style.display='';}this._set_loader_text(8);}this.init9();};this.init9=function(){if(this.use_bbcode){if(this.div_panel_color){if(typeof(BBColors)=='undefined'){this.import_js(this.file_path+'ed_colors.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init9();",100);return;}this.div_panel_color.cl=new BBColors(this,'div_panel_color');this.div_panel_color.style.display='';}this._set_loader_text(9);}this.init10();};this.init10=function(){if(this.use_bbcode){if(this.div_moder_tags){if(typeof(BBModTags)=='undefined'){this.import_js(this.file_path+'ed_mod_tags.js');window.setTimeout("BBEditors['"+this.editor_id+"'].init10();",100);return;}this.div_moder_tags.cl=new BBModTags(this,'div_moder_tags');this.div_moder_tags.style.display='';}} this._set_loader_text(10);this.initialize=true;};this._set_loader_text=function(step){if(!this._loader||!this._wrap){return;}this._loader.innerHTML=BBEditors_loading_message+' ('+step+'/10).' };this.init_loader=function(){if(!this._loader||!this._wrap){if(this.loader){this.loader.style.display='none';}if(this._wrap){this._wrap.style.display='';}return;}var _o=this._loader;this._wrap.style.display='none';_o.style.display='';_o.style.border='solid 1px black';_o._green=0;_o._add=1;_o._idtime=window.setInterval("BBEditors['"+this.editor_id+"']._loading();",20);};this._loading=function(){var _o=this._loader;if(this.initialize){window.clearInterval(_o._idtime);_o.style.display='none';this._wrap.style.display='';return;}_o.style.color=_o.style.borderColor="#"+parseInt(_o._green).toString(16)+parseInt(_o._green).toString(16)+parseInt(_o._green).toString(16);_o._green=parseInt(_o._green)+parseInt(_o._add);if(parseInt(_o._green) <= 0){_o._add=1;_o._green=0;}if(parseInt(_o._green) >= 15){_o._add=-1;_o._green=15;}};this.import_js=function(path,id,ignore){var i,scripts=document.getElementsByTagName("script");for(i=0;i<scripts.length;i++){if(!ignore&&parseInt(ignore)!=1){if(scripts[i].src==path){return false;}}else{ if(scripts[i]._id==id){return false;}}}var script=document.createElement('script');script.type='text/javascript';script.src=path;if(!id||id!='undefined'){script._id=id;}document.getElementsByTagName('head')[0].appendChild(script);return true;};this._fix_textarea_width=function(){var _off=10;var _o=this._textarea;var _w=100;try{_w=_o.parentNode.offsetWidth;if(parseInt(_o.offsetWidth)+_off!=_w&&this.initialize&&this._wind_resize){_o.style.width='1px';_w=_o.parentNode.offsetWidth;_o.style.width=(_w-_off)+'px';this._wind_resize=false;}}catch(el){} window.setTimeout("BBEditors['"+this.editor_id+"']._fix_textarea_width();",1);};this._wind_on_resize=function(){for(var i in BBEditors){BBEditors[i]._wind_resize=true;}if(window._onresize!=null){window._onresize();}};this._init_textarea=function(){var e_rows=ipsclass.my_getcookie('editor_'+this.editor_id+'_rows');if(isNaN(parseInt(e_rows))){e_rows=BBEditors_minimum_rows;}this._textarea.rows=e_rows;if(window._onresize_hook=='undefined'){window._onresize_hook=true;if(typeof(window.onresize)!='undefined'){window._onresize=window.onresize;}else{ window._onresize=null;}window.onresize=this._wind_on_resize;}window.setTimeout("BBEditors['"+this.editor_id+"']._fix_textarea_width();",500);this._textarea.onkeydown = function(ev){
	if ( ev.keyCode == 13 && ev.ctrlKey ) {
		try {
			var t = this.form.querySelector("[name=submit]") || this.form.querySelector("[name=dosubmit]") || this.form.querySelector("[type=button][onclick^=ajax_save_for_edit]");
			t && t.click();
			ev.preventDefault();
		}
		catch(e){}
		return false;
	}
};if(is_ie){this._textarea.onselect=this._textarea.onkeyup=this._textarea.onmouseup=function(e){this._sel=null;if(typeof(document.selection)!='undefined'&&document.selection.type!='Text'&&document.selection.type!='None'){return;}this._sel=document.selection.createRange();};this._textarea.onfocus=function(e){if(this._sel){this._sel.select();}};return;}this._textarea._selStart=0;this._textarea._selEnd=0;this._textarea.onblur=this._textarea.onclick=this._textarea.onmouseup=this._textarea.onmousedown=this._textarea.onselect=this._textarea.onkeyup=this._textarea_save_sel;this._textarea.onfocus=this._textarea_load_sel;};this._textarea_save_sel=function(){this._selStart=this.selectionStart;this._selEnd=this.selectionEnd;};this._textarea_load_sel=function(){this.selectionStart=this._selStart;this.selectionEnd=this._selEnd;};this.create_panel_title=function(_obj,title){if(!_obj){return;}if(title.replace(new RegExp("^\s*(.*?)\s*$","g"),'$1')==''){return;}_obj.innerHTML=title;};this.parse_style=function(txt){var arr=new Array();var a1=txt.split(';');for(var i=0;i<a1.length;i++){var a2=a1[i].split(':');if(a2.length!=2){continue;}var key=a2[0].replace(new RegExp("^\s*(.*?)\s*$","g"),'$1');var val=a2[1].replace(new RegExp("^\s*(.*?)\s*$","g"),'$1');arr[key]=val;var nkeys=key.split('-');var key2=nkeys[0];for(var t=1;t<nkeys.length;t++){var tk2=nkeys[t].substr(0,1).toUpperCase()+nkeys[t].substr(1).toLowerCase();key2+=tk2;}if(key2!=key){arr[key2]=val;}} return arr;};this.set_focus=function(e){try{if(!this._textarea._is_sel){this._textarea.focus();}}catch(el){} };this.wrap_text=function(_1,_2){var sel=null;var _b='';var _c='';var _a='';if(is_ie){this.set_focus();if(typeof(document.selection) !='undefined'&&document.selection.type!='Text'&&document.selection.type!='None'){document.selection.clear();}if(this._textarea._sel){sel=this._textarea._sel;}else{ sel=document.selection.createRange();}_c=sel.text;}else{ var _t=this._textarea.value;sel=this._textarea._selStart;_b=_t.substr(0,this._textarea._selStart);_c=_t.substr(this._textarea._selStart,this._textarea._selEnd-this._textarea._selStart);_a=_t.substr(this._textarea._selEnd);}if(_c.substr(0,_1.length).toUpperCase()==_1.toUpperCase()&&_c.substr(_c.length-_2.length).toUpperCase()==_2.toUpperCase()){_c=_c.substr(_1.length,_c.length-_1.length-_2.length);}else{ _c=_1+_c+_2;}if(is_ie){try{ sel.text=_c;this._textarea._sel=sel;sel.select();}catch(e){} }else{ this._textarea.value=_b+_c+_a;this._textarea._selStart=this._textarea._selEnd=sel;this._textarea._selEnd+=_c.length;this.set_focus();window.setTimeout("var obj=BBEditors['"+this.editor_id+"']._textarea;obj.selectionStart="+sel+";obj.selectionEnd="+(sel+_c.length)+";try{obj.onblur();}catch(e){}",1);}return false;};this.wrap_text_option=function(code,option){var sel=null;var _b='';var _c='';var _a='';if(is_ie){this.set_focus();if(typeof(document.selection) !='undefined'&&document.selection.type!='Text'&&document.selection.type!='None'){document.selection.clear();}if(this._textarea._sel){sel=this._textarea._sel;}else{ sel=document.selection.createRange();}_c=sel.text;}else{ sel=this._textarea._selStart;var _t=this._textarea.value;_b=_t.substr(0,this._textarea._selStart);_c=_t.substr(this._textarea._selStart,this._textarea._selEnd-this._textarea._selStart);_a=_t.substr(this._textarea._selEnd);}if(_c.substr(0,code.length+2)=='['+code+'='&&_c.substr(_c.length-code.length-3)=='[/'+code+']'){var _o1=_c.indexOf(']');var _o2=_c.indexOf('[/'+code+']');if((_o1<_o2)&&(_o1 >(code.length+2))){var match=_c.substr(0,code.length+option.length+3);_c=_c.substr(_o1+1,(_c.length-(code.length+4+_o1)));if(match!='['+code+'='+option+']'){_c='['+code+'='+option+']'+_c+'[/'+code+']';}}else{ _c='['+code+'='+option+']'+_c+'[/'+code+']';}}else{ _c='['+code+'='+option+']'+_c+'[/'+code+']';}if(is_ie){try{ sel.text=_c;this._textarea._sel=sel;sel.select();}catch(e){} }else{ this._textarea.value=_b+_c+_a;this._textarea._selStart=this._textarea._selEnd=sel;this._textarea._selEnd+=_c.length;this.set_focus();window.setTimeout("var obj=BBEditors['"+this.editor_id+"']._textarea;obj.selectionStart="+sel+";obj.selectionEnd="+(sel+_c.length)+";try{obj.onblur();}catch(e){}",1);}return false;};this.insert_text=function(text){var sel=null;if(!text||text.lenght==0||text.replace(new RegExp("^\s*(.*?)\s*$","gm"),'$1')==''){return;}if(is_ie){this.set_focus();if(typeof(document.selection)!='undefined'&&document.selection.type!='Text'&&document.selection.type!='None'){document.selection.clear();}sel=document.selection.createRange();sel.text=text;this._textarea._sel=sel;sel.select();}else{ var _t=this._textarea.value;sel=this._textarea._selStart;var _b=_t.substr(0,this._textarea._selStart);var _a=_t.substr(this._textarea._selEnd);this._textarea.value=_b+text+_a;this._selStart=sel;this._selEnd=sel+text.length;this.set_focus();window.setTimeout("var obj=BBEditors['"+this.editor_id+"']._textarea;obj.selectionStart="+sel+";obj.selectionEnd="+(sel+text.length)+";try{obj.onblur();}catch(e){}",1);}};this.get_select_text=function(){var _text='';if(is_ie){this.set_focus();if(this._textarea._sel){sel=this._textarea._sel;}else{ if(typeof(document.selection)!='undefined'&&document.selection.type!='Text'&&document.selection.type!='None'){document.selection.clear();}sel=document.selection.createRange();}_text=sel.text;sel.select();}else{ var _t=this._textarea;_text=_t.value.substr(_t._selStart,_t._selEnd-_t._selStart);}return _text;};this.init();}function ValidateForm(){return validate_form();}function validate_form(){try{if(ipsattach.has_upload_pending){if(confirm(ipb_global_lang['post_upload_not_empty'])){return true;}else{return false;}}}catch(e){}return true;}
