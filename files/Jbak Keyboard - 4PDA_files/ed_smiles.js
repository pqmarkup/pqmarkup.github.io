function BBSmiles(BBEditor, _obj) {this.initialize = false;this.BBEditor = BBEditor;this.editor_id = BBEditor.editor_id;this._obj = BBEditor[_obj];this._obj_name = _obj;this.smiles = new Array;this.obj_sel = null;this.init = function () {if (this.initialize || !this._obj) {return;}this._obj.innerHTML = '';this._obj.className = 'ed-emo-panel';if ( jsEmoticons ) {BBEditors_smiles = jsEmoticons.getEmots();for ( var i in BBEditors_smiles ) {BBEditors_smiles [ i ] = { 'image' : BBEditors_smiles [ i ] [ 0 ], 'click' : ( BBEditors_smiles [ i ] [ 1 ] ? '1' : '0' ) };}}if (typeof (BBEditors_smiles) == 'undefined') {this.BBEditor.import_js('style_images/js_emo_' + ipb_skin_emodir + '.js', this.editor_id, 1);window.setTimeout("BBEditors['" + this.editor_id + "']['" + this._obj_name + "'].cl.init();", 200);return;}this.build_smiles(true);this.initialize = true;};this.parse_html_schar_stat = function (text) {var retval = text;var repl_arr = {'<': /\&lt\;/g,'>': /\&gt\;/g};for (var i in repl_arr) {retval = retval.replace(repl_arr[i], i);}return retval;};this.parse_html_schar_int = function (a1, a2) {return String.fromCharCode(a2);};this.insert_smile = function (emo) {var _t = emo;_t = _t.replace(/\&\#([0-9]{1,4})\;/g, this.parse_html_schar_int);_t = this.parse_html_schar_stat(_t);this.BBEditor.insert_text(' ' + _t + ' ');};this.build_smiles = function (upd) {this._obj.innerHTML = '';if (upd == true) {var cs = new String(unescape(ipsclass.my_getcookie('ed-custom-smiles-' + ipb_skin_emodir)));this.smiles = new Array();if (cs == '' || cs == 'undefined') {this.get_def_smiles();} else {this.smiles = cs.split(',');for (var i = 0; i < this.smiles.length; i++) {var gg = this.smiles[i].replace(/\&\#44\;/g, ',');this.smiles[i] = gg;}}}for (var i = 0; i < this.smiles.length; i++) {if (this.smiles[i] == '') {continue;}if (typeof (BBEditors_smiles[this.smiles[i]]) != 'object') {continue;}var img = document.createElement('img');img.src = "http://s.4pda.ru/forum/style_emoticons/" + ipb_skin_emodir + "/" + BBEditors_smiles[this.smiles[i]]['image'] + "";img.border = '0';img.className = 'ed-emo-normal';img.title = img.alt = this.smiles[i];img.emo = this.smiles[i];img.editor_id = this.editor_id;img._obj_name = this._obj_name;img._is_down = 0;img.onmousemove = function () {if (!this._is_down) {this.className = 'ed-emo-hover';}};img.onmouseout = function () {this._is_down = 0;this.className = 'ed-emo-normal';};img.onmousedown = function () {this._is_down = 1;this.className = 'ed-emo-down';};img.onmouseup = function () {this._is_down = 0;this.className = 'ed-emo-hover';};img.onclick = function () {BBEditors[this.editor_id][this._obj_name].cl.insert_smile(this.emo);};this._obj.appendChild(img);}var sm_div = document.createElement('div');sm_div.className = 'ed-emo-link';sm_div.innerHTML = '';var _a = document.createElement('a');_a.href = '#';_a.editor_id = this.editor_id;_a._obj_name = this._obj_name;_a.onclick = this.select_custom_emo;_a.innerHTML = 'выбрать смайлы';sm_div.appendChild(_a);this._obj.appendChild(sm_div);this.obj_sel = document.createElement('div');this.obj_sel.style.display = 'none';this.obj_sel._p = document.createElement('div');this.obj_sel._p.style.display = 'none';this._obj.appendChild(this.obj_sel);this._obj.appendChild(this.obj_sel._p);};this.get_def_smiles = function () {this.smiles = new Array();for (var i in BBEditors_smiles) {if (parseInt(BBEditors_smiles[i]['click']) == 1) {this.smiles[this.smiles.length] = i;}}};this.select_custom_emo = function () {var bbed = BBEditors[this.editor_id][this._obj_name].cl;var _l = 0,_t = 0,_w = 0,_h = 0;_l = ((document.all) ? document.documentElement.scrollLeft : window.pageXOffset);_t = ((document.all) ? document.documentElement.scrollTop : window.pageYOffset);_w = document.documentElement.clientWidth;_h = document.documentElement.clientHeight;var _o = bbed.obj_sel;var _p = _o._p;_o.style.position = 'absolute';try {_o.style.opacity = '0.5';_o.style.filter = "alpha(opacity=50)";} catch (e) {}_o.style.backgroundColor = '#000';_o.style.left = _l + 'px';_o.style.top = _t + 'px';_o.style.width = _w + 'px';_o.style.height = _h + 'px';_o.style.zIndex = '9998';_p.style.position = 'absolute';_p.style.width = '400px';_p.style.height = '300px';_p.style.border = 'solid 2px black';_p.style.left = (_l + ((_w - 400) / 2)) + 'px';_p.style.top = (_t + ((_h - 300) / 2)) + 'px';_p.style.background = 'white';_p.style.overflow = 'auto';_p.style.zIndex = '9999';try {_p.style.overflowX = 'hidden';} catch (e) {}var chk_arr = new Array();_p.innerHTML = '';var _p_d;try {_p_d = document.createElement('<div style="text-align:justyfy">');} catch (el) {_p_d = document.createElement('div');_p_d.style.textAlign = 'justyfy';}_p.appendChild(_p_d);for (var _i in BBEditors_smiles) {try {chk_arr[_i] = document.createElement('<img />');} catch (e) {chk_arr[_i] = document.createElement('img');}try {chk_arr[_i].align = 'middle';} catch (el) {}chk_arr[_i].style.margin = '10px';chk_arr[_i].src = "http://s.4pda.ru/forum/style_emoticons/" + ipb_skin_emodir + "/" + BBEditors_smiles[_i]['image'];try {chk_arr[_i].style.cursor = 'pointer';chk_arr[_i].style.cursor = 'hand';} catch (el) {}try {chk_arr[_i].style.opacity = '0.5';} catch (el) {}try {chk_arr[_i].style.filter = 'alpha(opacity=50)';} catch (el) {}_p_d.appendChild(chk_arr[_i]);chk_arr[_i].editor_id = this.editor_id;chk_arr[_i]._obj_name = this._obj_name;try {chk_arr[_i].type = 'checkbox';} catch (e) {}chk_arr[_i]._chk = false;chk_arr[_i].onclick = function () {var cl = BBEditors[this.editor_id][this._obj_name].cl;if (this._chk == false) {cl.add_smile(this.value);this._chk = true;try {this.style.opacity = '1';} catch (el) {}try {this.style.filter = '';} catch (el) {}} else {cl.del_smile(this.value);this._chk = false;try {this.style.opacity = '0.5';} catch (el) {}try {this.style.filter = 'alpha(opacity=50)';} catch (el) {}}};chk_arr[_i].value = _i;}for (var _i = 0; _i < bbed.smiles.length; _i++) {if (typeof (chk_arr[bbed.smiles[_i]]) != 'object') {continue;}try {chk_arr[bbed.smiles[_i]].style.opacity = '';} catch (el) {}try {chk_arr[bbed.smiles[_i]].style.filter = '';} catch (el) {}chk_arr[bbed.smiles[_i]].checked = true;chk_arr[bbed.smiles[_i]]._chk = true;}_p.appendChild(_p_d);var _a = document.createElement('a');_a.innerHTML = 'Сохранить и закрыть';_a.href = '#';_a._o = _o;_a.style.color = 'black';_a.style.fontSize = '24px';_a.style.textDecoration = 'none';_a.style.fontWeight = 'bold';_a.onclick = function () {this._o.onclick();return false;};_p.style.textAlign = 'center';_p.appendChild(_a);_o._onscroll = window.onscroll;eval("window.onscroll=function(){window.scroll(" + _l + "," + _t + ");return false;};");try {_o.style.cursor = 'pointer';_o.style.cursor = 'hand';} catch (e) {}_o.editor_id = this.editor_id;_o._obj_name = this._obj_name;_o.onclick = function () {this.style.display = 'none';this._p.style.display = 'none';document.body.overflow = '';window.onscroll = this._onscroll;BBEditors[this.editor_id][this._obj_name].cl.build_smiles();};_o.style.display = '';_o._p.style.display = '';window.setTimeout("window.scrollTo(" + _l + "," + _t + ");", 1);return false;};this.checksmile = function () {var cl = BBEditors[this.editor_id][this._obj_name].cl;var val = this.value;val = val.replace(/,/g, '&#44;');if (this.checked == true) {cl.add_smile(val);} else {cl.del_smile(val);}};this.add_smile = function (id) {var gg = id;gg = gg.replace(/,/g, '&#44;');this.smiles[this.smiles.length] = gg;ipsclass.my_setcookie('ed-custom-smiles-' + ipb_skin_emodir, escape(this.smiles.join(',')), 1);};this.del_smile = function (id) {var narr = new Array();for (var i = 0; i < this.smiles.length; i++) {if (typeof (BBEditors_smiles[this.smiles[i]]) != 'object') {continue;}if (this.smiles[i] == id) {continue;}narr[narr.length] = this.smiles[i];}this.smiles = new Array();this.smiles = narr;ipsclass.my_setcookie('ed-custom-smiles-' + ipb_skin_emodir, escape(this.smiles.join(',')), 1);};this.init();}